<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="de">
<head>
<!-- Generated by javadoc (1.8.0_252) on Mon Aug 03 19:07:37 CEST 2020 -->
<title>CryptoCore</title>
<meta name="date" content="2020-08-03">
<link rel="stylesheet" type="text/css" href="../../../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="CryptoCore";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":10,"i1":10,"i2":10,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CryptoCore.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/ERSSpecificModule.html" title="class in main.java.de.bsi.tsesimulator.tse"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?main/java/de/bsi/tsesimulator/tse/CryptoCore.html" target="_top">Frames</a></li>
<li><a href="CryptoCore.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">main.java.de.bsi.tsesimulator.tse</div>
<h2 title="Class CryptoCore" class="title">Class CryptoCore</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>main.java.de.bsi.tsesimulator.tse.CryptoCore</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">CryptoCore</span>
extends java.lang.Object</pre>
<div class="block">This class represents the cryptographic service provider of the TSE.
 It manages the chosen signature algorithm and uses it to create the signatures present in the log messages. 
 It also parses the certificate corresponding to the private key of the TSE used for the signature creation to provide an answer to the question of whether 
 this certificate has expired.
 Additionally it is the guardian of the internal clock of the TSE which can not be accessed without using this CryptoCore.
 <br>
 Please note, that this class is <b>NOT</b> a cryptographic service provider as described in BSI-CC-PP-CSP! Hence, the name <i>CryptoCore</i> instead of <i>CryptoCore</i>.
 Please be also aware of the fact, that this implementation may have flaws that could endanger a real TSE implementation and should not be seen a safe 
 implementation for usage in projects other than this simulator.</div>
<dl>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
<dt><span class="simpleTagLabel">Author:</span></dt>
<dd>dpottkaemper</dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#algorithm">algorithm</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.time.Clock</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#clock">clock</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private java.util.Date</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#privKeyNotAfter">privKeyNotAfter</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.util.Date</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#privKeyNotBefore">privKeyNotBefore</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#signatureCounter">signatureCounter</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>private java.util.Date</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#tseCertNotAfter">tseCertNotAfter</a></span></code>&nbsp;</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code>private java.util.Date</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#tseCertNotBefore">tseCertNotBefore</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#CryptoCore--">CryptoCore</a></span>()</code>
<div class="block">The default constructor for the CryptoCore.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colOne"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#CryptoCore-long-long-">CryptoCore</a></span>(long&nbsp;loadedSigCntr,
          long&nbsp;loadedUnixTime)</code>
<div class="block">The constructor that shall be used if the signature counter and the last time are to be loaded from a file.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>private byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#calculateSerialNumber--">calculateSerialNumber</a></span>()</code>
<div class="block">According to TR-03116-5 chapter 3.1.1 the serial number is calculated through hashing the public key used to verify the signatures 
 with a SHA-2 256 bit.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#getAlgorithm--">getAlgorithm</a></span>()</code>
<div class="block">Provides access to the algorithm object used by this crypto core.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#getSerialNumber--">getSerialNumber</a></span>()</code>
<div class="block">Calculates the hash of the public key that is used to perform the verification of signatures and return that hash.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#getSignatureCounter--">getSignatureCounter</a></span>()</code>
<div class="block">A method to get the current signature counter value from the CryptoCore.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>long</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#getTimeAsUnixTime--">getTimeAsUnixTime</a></span>()</code>
<div class="block">Calls the CryptoCore clock for the current time and converts it to UnixTime through the Clock.instant().getEpochSecond() method.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#hashByteArray-byte:A-">hashByteArray</a></span>(byte[]&nbsp;toBeHashed)</code>
<div class="block">Hashes a byte array using the BouncyCastle implementation of the SHA-256 algorithm.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#isCertificateExpired--">isCertificateExpired</a></span>()</code>
<div class="block">This function is used to check, whether the TSE certificate corresponding to the private key that is used for signing the log messages is still valid.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#isVerified-byte:A-byte:A-">isVerified</a></span>(byte[]&nbsp;signatureValue,
          byte[]&nbsp;unsignedValue)</code>
<div class="block">Calls the <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html#verify-byte:A-byte:A-"><code>SignatureAlgorithm.verify(byte[], byte[])</code></a> method in its non-abstract implementation as defined by the signature algorithm used at runtime.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>private void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#parseTseCertificate--">parseTseCertificate</a></span>()</code>
<div class="block">This function parses the certificate corresponding to the private key of the TSE to store relevant values for later use.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#setClock--">setClock</a></span>()</code>
<div class="block">Sets the internal clock to the current system clock with the default system time zone.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#setClock-java.time.ZonedDateTime-">setClock</a></span>(java.time.ZonedDateTime&nbsp;timeNew)</code>
<div class="block">Sets the internal clock to a certain point in time.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>byte[]</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#sign-byte:A-">sign</a></span>(byte[]&nbsp;upperMessagePart)</code>
<div class="block">Takes a byte array, theoretically <b>any</b> byte array, adds a TLVObject containing the signature counter and one containing
 the log time, converts them both into TLV byte arrays, attaches them to the byte array it was given and then signs all of
 that.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="signatureCounter">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>signatureCounter</h4>
<pre>private&nbsp;long signatureCounter</pre>
</li>
</ul>
<a name="clock">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>clock</h4>
<pre>private&nbsp;java.time.Clock clock</pre>
</li>
</ul>
<a name="algorithm">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>algorithm</h4>
<pre>private&nbsp;<a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a> algorithm</pre>
</li>
</ul>
<a name="tseCertNotAfter">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tseCertNotAfter</h4>
<pre>private&nbsp;java.util.Date tseCertNotAfter</pre>
</li>
</ul>
<a name="tseCertNotBefore">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>tseCertNotBefore</h4>
<pre>private&nbsp;java.util.Date tseCertNotBefore</pre>
</li>
</ul>
<a name="privKeyNotAfter">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>privKeyNotAfter</h4>
<pre>private&nbsp;java.util.Date privKeyNotAfter</pre>
</li>
</ul>
<a name="privKeyNotBefore">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>privKeyNotBefore</h4>
<pre>private&nbsp;java.util.Date privKeyNotBefore</pre>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="CryptoCore--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>CryptoCore</h4>
<pre>public&nbsp;CryptoCore()
           throws java.io.IOException</pre>
<div class="block">The default constructor for the CryptoCore. It uses the config.properties file to determine which signature algorithm it shall use, then uses the chose 
 algorithm (either ECDSA or ECSDSA) to create a <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a> object accordingly.
 This signature algorithm is then used to perform the signing operations.
 This constructor also sets the internal clock and the signature counter to the default values of the current system time and zero.
 
 Additionally, the constructor also tries to parse the certificate corresponding to the private key of the TSE and store the relevant values in instance 
 variables.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - if the keys for the ECSDSA or the ECDSA could not be found or parsed.</dd>
</dl>
</li>
</ul>
<a name="CryptoCore-long-long-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>CryptoCore</h4>
<pre>public&nbsp;CryptoCore(long&nbsp;loadedSigCntr,
                  long&nbsp;loadedUnixTime)
           throws java.io.IOException,
                  <a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/IllegalValueLoadedException.html" title="class in main.java.de.bsi.tsesimulator.exceptions">IllegalValueLoadedException</a></pre>
<div class="block">The constructor that shall be used if the signature counter and the last time are to be loaded from a file.
 It checks if the signature counter is a legal, non-negative value.
 Like the default constructor, this one attempts to find and parse the certificate corresponding to the private key of the TSE. If this is successful, 
 the constructor then stores relevant values in instance variables for quick access.
 The primary usage of this constructor is by SecurityModule#SM(boolean, long, long, long)</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>loadedSigCntr</code> - the signature counter loaded from the persistence file.</dd>
<dd><code>loadedUnixTime</code> - the time loaded from the persistence file</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - if the keys for the ECSDSA or the ECDSA could not be found or parsed.</dd>
<dd><code><a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/IllegalValueLoadedException.html" title="class in main.java.de.bsi.tsesimulator.exceptions">IllegalValueLoadedException</a></code> - if the signature counter loaded is illegal</dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getSignatureCounter--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSignatureCounter</h4>
<pre>public&nbsp;long&nbsp;getSignatureCounter()
                         throws <a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/ErrorSignatureCounterOverflow.html" title="class in main.java.de.bsi.tsesimulator.exceptions">ErrorSignatureCounterOverflow</a></pre>
<div class="block">A method to get the current signature counter value from the CryptoCore.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the signatureCounter value if it isn't negative</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/ErrorSignatureCounterOverflow.html" title="class in main.java.de.bsi.tsesimulator.exceptions">ErrorSignatureCounterOverflow</a></code> - if the signatureCounter value is negative. This should only happen, if the signatureCounter value overflows.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
</dl>
</li>
</ul>
<a name="getTimeAsUnixTime--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getTimeAsUnixTime</h4>
<pre>public&nbsp;long&nbsp;getTimeAsUnixTime()</pre>
<div class="block">Calls the CryptoCore clock for the current time and converts it to UnixTime through the Clock.instant().getEpochSecond() method.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the current UnixTime as a long.</dd>
</dl>
</li>
</ul>
<a name="sign-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>sign</h4>
<pre>public&nbsp;byte[]&nbsp;sign(byte[]&nbsp;upperMessagePart)
            throws java.security.SignatureException,
                   <a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/ErrorSignatureCounterOverflow.html" title="class in main.java.de.bsi.tsesimulator.exceptions">ErrorSignatureCounterOverflow</a></pre>
<div class="block">Takes a byte array, theoretically <b>any</b> byte array, adds a TLVObject containing the signature counter and one containing
 the log time, converts them both into TLV byte arrays, attaches them to the byte array it was given and then signs all of
 that.
 <br>For the signature creation it uses the <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a> that has been configured. It returns the 
 byte arrays containing the signature counter, the log time and the signature itself.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>upperMessagePart</code> - the byte array that shall be signed</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>3 byte arrays concatenated, namely: the signature counter as a TLV byte array, the log time as a TLV byte array
 and the signature as a TLV byte array.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.security.SignatureException</code> - if the underlying <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a> throws an <a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/TR_03111_ECC_V2_1_Exception.html" title="class in main.java.de.bsi.tsesimulator.exceptions">TR_03111_ECC_V2_1_Exception</a>.</dd>
<dd><code><a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/ErrorSignatureCounterOverflow.html" title="class in main.java.de.bsi.tsesimulator.exceptions">ErrorSignatureCounterOverflow</a></code> - if the current signature counter value equals Long.MAX_VALUE - 1. This is requested by BSI TR-03153 chapter 4.1.</dd>
</dl>
</li>
</ul>
<a name="isVerified-byte:A-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isVerified</h4>
<pre>public&nbsp;boolean&nbsp;isVerified(byte[]&nbsp;signatureValue,
                          byte[]&nbsp;unsignedValue)
                   throws <a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/VerifyingOperationFailedException.html" title="class in main.java.de.bsi.tsesimulator.exceptions">VerifyingOperationFailedException</a></pre>
<div class="block">Calls the <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html#verify-byte:A-byte:A-"><code>SignatureAlgorithm.verify(byte[], byte[])</code></a> method in its non-abstract implementation as defined by the signature algorithm used at runtime.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>signatureValue</code> - the byte array representing the signature one wants to verify</dd>
<dd><code>unsignedValue</code> - the byte array representing the data which has been signed and corresponds to the signedValue</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>true, if the signature could be verified. False otherwise.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../main/java/de/bsi/tsesimulator/exceptions/VerifyingOperationFailedException.html" title="class in main.java.de.bsi.tsesimulator.exceptions">VerifyingOperationFailedException</a></code> - if something happens inside the algorithm that causes the verification method to fail.</dd>
</dl>
</li>
</ul>
<a name="getAlgorithm--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getAlgorithm</h4>
<pre>public&nbsp;<a href="../../../../../../main/java/de/bsi/tsesimulator/tse/crypto/SignatureAlgorithm.html" title="class in main.java.de.bsi.tsesimulator.tse.crypto">SignatureAlgorithm</a>&nbsp;getAlgorithm()</pre>
<div class="block">Provides access to the algorithm object used by this crypto core.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the algorithm object</dd>
</dl>
</li>
</ul>
<a name="calculateSerialNumber--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>calculateSerialNumber</h4>
<pre>private&nbsp;byte[]&nbsp;calculateSerialNumber()</pre>
<div class="block">According to TR-03116-5 chapter 3.1.1 the serial number is calculated through hashing the public key used to verify the signatures 
 with a SHA-2 256 bit. This method performs the hashing.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the hash over the public key</dd>
</dl>
</li>
</ul>
<a name="getSerialNumber--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSerialNumber</h4>
<pre>public&nbsp;byte[]&nbsp;getSerialNumber()</pre>
<div class="block">Calculates the hash of the public key that is used to perform the verification of signatures and return that hash.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the hash of the public key</dd>
</dl>
</li>
</ul>
<a name="setClock-java.time.ZonedDateTime-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setClock</h4>
<pre>public&nbsp;void&nbsp;setClock(java.time.ZonedDateTime&nbsp;timeNew)
              throws <a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorInvalidTime.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorInvalidTime</a>,
                     <a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorUpdateTimeFailed.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorUpdateTimeFailed</a></pre>
<div class="block">Sets the internal clock to a certain point in time. Gets called by the TSEController to provide the functionality of the <a href="../../../../../../main/java/de/bsi/seapi/SEAPI.html#updateTime-java.time.ZonedDateTime-">SEAPI.updateTime(ZonedDateTime)</a>
 method.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>timeNew</code> - the new time in the Java ZonedDatetime format.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorInvalidTime.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorInvalidTime</a></code> - if the new time is before 1.1.2019 0:0:0 or after the beginning of the year 2100.</dd>
<dd><code><a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorUpdateTimeFailed.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorUpdateTimeFailed</a></code> - if the execution of this function fails due to any other reason</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.0</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>java.time.ZonedDateTime}</code></dd>
</dl>
</li>
</ul>
<a name="setClock--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>setClock</h4>
<pre>public&nbsp;void&nbsp;setClock()
              throws <a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorUpdateTimeFailed.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorUpdateTimeFailed</a></pre>
<div class="block">Sets the internal clock to the current system clock with the default system time zone. Gets called by the TSEController to provide
 the functionality of the <a href="../../../../../../main/java/de/bsi/seapi/SEAPI.html#updateTime--">SEAPI.updateTime()</a> method.
 Should never raise an exception because the system time should always have a valid value.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="../../../../../../main/java/de/bsi/seapi/exceptions/ErrorUpdateTimeFailed.html" title="class in main.java.de.bsi.seapi.exceptions">ErrorUpdateTimeFailed</a></code> - if the execution of this function fails</dd>
</dl>
</li>
</ul>
<a name="hashByteArray-byte:A-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>hashByteArray</h4>
<pre>public&nbsp;byte[]&nbsp;hashByteArray(byte[]&nbsp;toBeHashed)</pre>
<div class="block">Hashes a byte array using the BouncyCastle implementation of the SHA-256 algorithm. Is used to hash user data related content.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>toBeHashed</code> - the byte array that shall be hashed</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the result as a byte array</dd>
</dl>
</li>
</ul>
<a name="isCertificateExpired--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isCertificateExpired</h4>
<pre>public&nbsp;boolean&nbsp;isCertificateExpired()</pre>
<div class="block">This function is used to check, whether the TSE certificate corresponding to the private key that is used for signing the log messages is still valid.
 The main class to use this function is <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/TSEController.html" title="class in main.java.de.bsi.tsesimulator.tse">TSEController</a> for all the functions that may raise an ErrorCertificateExpired exception.
 
 The check for validity is performed against the values of the fields <i>Validity</i> and the extension <i>PrivateKeyUsagePeriod</i>, if the certificate contains this 
 extension.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>false, if the certificate is <b>not expired</b>, true otherwise.</dd>
</dl>
</li>
</ul>
<a name="parseTseCertificate--">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>parseTseCertificate</h4>
<pre>private&nbsp;void&nbsp;parseTseCertificate()
                          throws java.io.IOException</pre>
<div class="block">This function parses the certificate corresponding to the private key of the TSE to store relevant values for later use.
 Those values are needed for the function <a href="../../../../../../main/java/de/bsi/tsesimulator/tse/CryptoCore.html#isCertificateExpired--">isCertificateExpired()</a>.</div>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code> - if something prevents the function to read or parse the certificate correctly, or <a href="../../../../../../main/java/de/bsi/tsesimulator/preferences/PropertyValues.html#getInstance--">PropertyValues.getInstance()</a> throws it.</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/CryptoCore.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../../index-files/index-1.html">Index</a></li>
<li><a href="../../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li><a href="../../../../../../main/java/de/bsi/tsesimulator/tse/ERSSpecificModule.html" title="class in main.java.de.bsi.tsesimulator.tse"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../../../index.html?main/java/de/bsi/tsesimulator/tse/CryptoCore.html" target="_top">Frames</a></li>
<li><a href="CryptoCore.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
